import{j as e,X as B,r as x,s as P,t as J}from"./index-_x4LqXeA.js";import{s as V,c as l,p as Z,a as I,b as C,d as O,e as w,f as g,g as k,i as D,h as y,j as K,k as W,l as A,m as Y}from"./storage-COxbdnGW.js";import{C as R}from"./check-PL_ZbQ2F.js";import{P as G}from"./power-UR2-Hce3.js";import{P as H}from"./plus-Dr61E6Gh.js";import{T as X}from"./trash-2-BfimlZ-T.js";import{C as $}from"./circle-check-asoqXxuc.js";import{C as Q}from"./circle-x-CWS9zTmO.js";import{C as ee}from"./clock-Dgf8poUI.js";function te({title:n,plans:c,selectedPlanId:r,onChangePlan:a,accountsUsed:h,maxAccounts:m,strategiesEnabled:u,enabledStrategyCount:f,maxStrategies:t,webhookEnabled:o,executionAllowed:b,limitReached:p,onOpenWebhook:N,onOpenStrategies:s}){return e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:n}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Plan:"}),e.jsx("select",{className:V,value:r,onChange:i=>a(i.target.value),disabled:c.length<=1,children:c.map(i=>e.jsx("option",{value:i.planId,children:i.planName},i.planId))})]}),e.jsxs("span",{className:l(C,p?Z:I),children:["Accounts: ",e.jsx("b",{className:"text-slate-100",children:h})," / ",e.jsx("b",{className:"text-slate-100",children:m||0})]}),e.jsxs("span",{className:l(C,u?O:I),children:["Strategies: ",u?"ON":"OFF"," (",f,"/",t||0,")"]}),e.jsxs("span",{className:l(C,o?O:I),children:["Webhook: ",o?"ON":"OFF"]}),e.jsx("span",{className:l(C,b?O:I),children:b?"Execution Enabled":"Execution Disabled"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{type:"button",className:l(g,w),onClick:N,children:"Webhook"}),e.jsx("button",{type:"button",className:l(g,w),onClick:s,children:"Strategies"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Accounts are priority. If follower doesn’t want to share token with trader, share the ",e.jsx("b",{className:"text-slate-200",children:"Master ID"})," and approve their request."]})]})}function U({open:n,title:c,onClose:r,children:a,widthClass:h="max-w-[520px]"}){return n?e.jsxs("div",{className:"fixed inset-0 z-[80]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/55",onClick:r}),e.jsxs("div",{className:l("absolute right-0 top-0 h-full w-full bg-slate-950 text-white shadow-2xl border-l border-white/10",h),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/10",children:[e.jsx("p",{className:"text-base font-semibold",children:c}),e.jsx("button",{type:"button",onClick:r,className:"rounded-lg p-2 hover:bg-white/5",children:e.jsx(B,{size:18})})]}),e.jsx("div",{className:"p-5",children:a})]})]}):null}function z(n){return JSON.stringify(n,null,2)}function se({open:n,onClose:c,plan:r,planSignals:a,setPlanSignals:h}){var N;const m=(r==null?void 0:r.planId)??"",u=!!(m&&((N=a[m])!=null&&N.webhookEnabled)),f=x.useMemo(()=>m?`https://api.yourdomain.com/webhook/copy/india/${m}`:"",[m]),t=x.useMemo(()=>({planId:m,masterId:"IND-CT-482913",symbol:"NIFTY",side:"BUY",qty:1,orderType:"MARKET",product:"MIS",userTag:"tv-alert-1",ts:new Date().toISOString()}),[m]),[o,b]=x.useState(null),p=async(s,i)=>{try{await navigator.clipboard.writeText(i),b(s),setTimeout(()=>b(null),900)}catch{}};return e.jsx(U,{open:n,onClose:c,title:"Webhook (TradingView)",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:l(y,"p-4"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Webhook Toggle"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Enable/disable TradingView signals for this plan."})]}),e.jsx("button",{type:"button",className:l(g,w),onClick:()=>{h(s=>{const i={...s,[m]:{...s[m]??{strategiesEnabled:!0,webhookEnabled:!1},webhookEnabled:!u}};return k("india.planSignals.v1",i),i})},children:u?"Webhook: ON":"Webhook: OFF"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-300",children:"Webhook URL"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("input",{className:D,value:f,readOnly:!0}),e.jsx("button",{type:"button",className:l(g,w,"px-3"),onClick:()=>p("URL",f),children:o==="URL"?e.jsx(R,{size:16}):e.jsx(P,{size:16})})]}),e.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:"Put this URL in TradingView alert → Webhook URL."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-slate-300",children:"Sample JSON Message"}),e.jsx("div",{className:l(y,"p-3 mt-2"),children:e.jsx("pre",{className:"text-[12px] leading-5 text-slate-200 overflow-auto max-h-[280px]",children:z(t)})}),e.jsxs("button",{type:"button",className:l(g,w,"mt-2"),onClick:()=>p("JSON",z(t)),children:[o==="JSON"?e.jsx(R,{size:16}):e.jsx(P,{size:16}),"Copy JSON"]})]}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"Note: Webhook is per-plan. You can keep webhook ON and strategies OFF, or vice-versa."})]}):e.jsx("div",{className:"text-sm text-slate-300",children:"Select a plan first."})})}function ae({open:n,onClose:c,plan:r,planSignals:a,setPlanSignals:h,strategies:m,selections:u,setSelections:f}){var s,i;const t=(r==null?void 0:r.planId)??"",o=!!(t&&((s=a[t])!=null&&s.strategiesEnabled)),b=((i=r==null?void 0:r.limits)==null?void 0:i.maxStrategies)??0,p=x.useMemo(()=>t?u[t]??[]:[],[t,u]),N=d=>{t&&f(j=>{const v=j[t]??[],M=v.includes(d);let E=v;if(M)E=v.filter(F=>F!==d);else{if(b>0&&v.length>=b)return j;E=[...v,d]}const S={...j,[t]:E};return k("india.strategySelections.v1",S),S})};return e.jsx(U,{open:n,onClose:c,title:"Strategies (Built-in)",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:l(y,"p-4"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Strategies Toggle"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Enable/disable built-in strategies for this plan."})]}),e.jsx("button",{type:"button",className:l(g,w),onClick:()=>{h(d=>{const j={...d,[t]:{...d[t]??{strategiesEnabled:!0,webhookEnabled:!1},strategiesEnabled:!o}};return k("india.planSignals.v1",j),j})},children:o?"Strategies: ON":"Strategies: OFF"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:l(C,I),children:["Plan limit: ",e.jsx("b",{className:"text-slate-100",children:b||0})]}),e.jsxs("span",{className:l(C,o?O:I),children:["Selected: ",e.jsx("b",{className:"text-slate-100",children:p.length})]})]}),e.jsx("div",{className:"space-y-3",children:m.map(d=>{const j=p.includes(d.id),v=!j&&b>0&&p.length>=b;return e.jsxs("button",{type:"button",disabled:!o||v,onClick:()=>N(d.id),className:l(y,"p-4 w-full text-left transition",j?"border-emerald-500/20 bg-emerald-500/10":"hover:bg-white/5",(!o||v)&&"opacity-60 cursor-not-allowed"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:d.name}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:d.description})]}),e.jsx("span",{className:l(C,j?O:I),children:j?"Enabled":"Disabled"})]}),v?e.jsx("div",{className:"text-[11px] text-amber-300 mt-2",children:"Plan strategy limit reached."}):null]},d.id)})}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"Strategies are per-plan. User cannot enable strategies from other plan here."})]}):e.jsx("div",{className:"text-sm text-slate-300",children:"Select a plan first."})})}function le(){return`IND-CT-${Math.floor(1e5+Math.random()*9e5)}`}function ne({slots:n,setSlots:c,maxAccounts:r}){const a=n.length,h=r>0&&a>=r,[m,u]=x.useState(null),f=async s=>{try{await navigator.clipboard.writeText(s),u(s),setTimeout(()=>u(null),900)}catch{}},t=()=>{const s=n.some(i=>!i.enabled);c(i=>i.map(d=>({...d,enabled:s})))},o=()=>{if(h)return;const s=new Date().toISOString();c(i=>[{id:`slot_${Date.now()}`,masterId:le(),broker:"KITE",nickname:"New Master",enabled:!0,token:"",createdAt:s,updatedAt:s},...i])},b=s=>c(i=>i.filter(d=>d.id!==s)),p=(s,i)=>c(d=>d.map(j=>j.id===s?{...j,...i,updatedAt:new Date().toISOString()}:j)),N=n.some(s=>s.enabled);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Master Accounts (shareable)"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Create master slots, share Master ID with followers. Token is optional (followers can attach token after approval)."})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{type:"button",className:l(g,w),onClick:t,disabled:n.length===0,children:[e.jsx(G,{size:16}),"ALL ON/OFF"]}),e.jsxs("button",{type:"button",className:l(g,K),onClick:o,disabled:h,children:[e.jsx(H,{size:16}),"Add Master"]})]})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Accounts used: ",e.jsx("span",{className:"text-slate-200 font-semibold",children:a}),r>0?e.jsxs(e.Fragment,{children:[" ","/ ",e.jsx("span",{className:"text-slate-200 font-semibold",children:r})]}):null,h?e.jsx("span",{className:"ml-2 text-amber-300",children:"Plan limit reached"}):null]}),n.length===0?e.jsx("div",{className:l(y,"p-4 text-sm text-slate-300"),children:"No master accounts yet. Click “Add Master”."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:n.map(s=>{const i=!s.token||s.token.trim()==="";return e.jsxs("div",{className:l(y,"p-4"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:s.nickname}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Broker: ",s.broker]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs",children:["Master ID:",e.jsx("b",{className:"text-slate-100",children:s.masterId})]}),e.jsxs("button",{type:"button",className:l(g,w,"h-8 px-3 text-xs"),onClick:()=>f(s.masterId),children:[m===s.masterId?e.jsx(R,{size:14}):e.jsx(P,{size:14}),"Copy"]})]})]}),e.jsx("button",{type:"button",className:l("h-9 w-14 rounded-full border transition relative",s.enabled?"bg-emerald-500/80 border-emerald-400/40":"bg-white/5 border-white/10"),onClick:()=>p(s.id,{enabled:!s.enabled}),"aria-pressed":s.enabled,children:e.jsx("span",{className:l("absolute top-[5px] h-6 w-6 rounded-full bg-slate-950 transition",s.enabled?"left-7":"left-[5px]")})})]}),e.jsxs("div",{className:"mt-4 grid gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:"Nickname"}),e.jsx("input",{className:D,value:s.nickname,onChange:d=>p(s.id,{nickname:d.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:"Broker"}),e.jsxs("select",{className:D,value:s.broker,onChange:d=>p(s.id,{broker:d.target.value}),children:[e.jsx("option",{value:"KITE",children:"Kite"}),e.jsx("option",{value:"DHAN",children:"Dhan"}),e.jsx("option",{value:"ANGEL",children:"Angel"}),e.jsx("option",{value:"UPSTOX",children:"Upstox"}),e.jsx("option",{value:"FYERS",children:"Fyers"}),e.jsx("option",{value:"SHOONYA",children:"Shoonya"}),e.jsx("option",{value:"ALICEBLUE",children:"AliceBlue"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:"Token (optional)"}),i?e.jsx("span",{className:"text-[11px] text-amber-300",children:"Missing"}):e.jsx("span",{className:"text-[11px] text-emerald-300",children:"Present"})]}),e.jsx("input",{className:D,value:s.token??"",onChange:d=>p(s.id,{token:d.target.value}),placeholder:"Paste token if trader will execute from this master"}),e.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:"If follower doesn't want to share token, keep this blank → follower adds token after approval."})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("button",{type:"button",className:l(g,w),onClick:()=>f(s.masterId),children:[e.jsx(P,{size:16}),"Share Master ID"]}),e.jsxs("button",{type:"button",className:l(g,W),onClick:()=>b(s.id),children:[e.jsx(X,{size:16}),"Delete"]})]})]})]},s.id)})})]})}function ie({requests:n,setRequests:c}){const[r,a]=x.useState(""),h=x.useMemo(()=>{const t=r.trim().toLowerCase();return t?n.filter(o=>(o.masterId+" "+o.followerName+" "+(o.followerEmail??"")).toLowerCase().includes(t)):n},[r,n]),m=(t,o)=>{c(b=>b.map(p=>p.id===t?{...p,status:o,updatedAt:new Date().toISOString()}:p))},u=t=>t==="APPROVED"?e.jsx($,{size:14,className:"text-emerald-300"}):t==="REJECTED"?e.jsx(Q,{size:14,className:"text-rose-300"}):e.jsx(ee,{size:14,className:"text-amber-300"}),f=t=>t==="APPROVED"?"border-emerald-500/20 bg-emerald-500/10 text-emerald-200":t==="REJECTED"?"border-rose-500/20 bg-rose-500/10 text-rose-200":"border-amber-500/20 bg-amber-500/10 text-amber-200";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Follower Requests"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Followers enter Master ID → request appears here → approve/reject."})]}),e.jsxs("div",{className:"w-full max-w-sm relative",children:[e.jsx(J,{size:16,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{className:l(D,"pl-9"),value:r,onChange:t=>a(t.target.value),placeholder:"Search masterId / name"})]})]}),h.length===0?e.jsx("div",{className:l(y,"p-4 text-sm text-slate-300"),children:"No requests yet."}):e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsx("div",{className:l(y,"p-4"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:t.followerName}),e.jsxs("span",{className:l("inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs",f(t.status)),children:[u(t.status)," ",t.status]})]}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Master ID: ",e.jsx("b",{className:"text-slate-200",children:t.masterId}),t.followerEmail?e.jsxs(e.Fragment,{children:[" ","• ",e.jsx("span",{className:"text-slate-300",children:t.followerEmail})]}):null]}),t.status==="APPROVED"?e.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:t.followerToken?"Follower token added.":"Waiting for follower token/credentials."}):null]}),t.status==="PENDING"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:l(g,w),onClick:()=>m(t.id,"APPROVED"),children:"Approve"}),e.jsx("button",{type:"button",className:l(g,W),onClick:()=>m(t.id,"REJECTED"),children:"Reject"})]}):e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Updated: ",new Date(t.updatedAt).toLocaleString()]})]})},t.id))})]})}const re=[{planId:"india_copy_basic",planName:"India Copy Basic",executionAllowed:!0,limits:{maxMasterAccounts:2,maxFollowers:20,maxStrategies:1}},{planId:"india_copy_elite",planName:"India Copy Elite",executionAllowed:!0,limits:{maxMasterAccounts:5,maxFollowers:200,maxStrategies:2}}],de=[{id:"simple_trend",name:"Simple Trend",description:"Basic trend-following entry/exit for copy plan."},{id:"breakout",name:"Breakout",description:"One breakout strategy (per plan limits)."}],ce=[{id:"slot_1",masterId:"IND-CT-482913",broker:"DHAN",nickname:"Dhan Master",enabled:!0,token:"",createdAt:"2026-01-20T03:27:00.000Z",updatedAt:"2026-01-20T03:27:00.000Z"},{id:"slot_2",masterId:"IND-CT-883120",broker:"KITE",nickname:"Kite Master",enabled:!0,token:"****",createdAt:"2026-01-19T12:37:00.000Z",updatedAt:"2026-01-20T08:58:00.000Z"}],oe=[{id:"req_1",masterId:"IND-CT-482913",followerName:"Rahul",followerEmail:"rahul@mail.com",status:"PENDING",createdAt:"2026-01-21T08:00:00.000Z",updatedAt:"2026-01-21T08:00:00.000Z"},{id:"req_2",masterId:"IND-CT-883120",followerName:"Neha",followerEmail:"neha@mail.com",status:"APPROVED",followerAccountLabel:"Neha Kite",followerToken:"****",createdAt:"2026-01-21T07:00:00.000Z",updatedAt:"2026-01-21T09:00:00.000Z"}];function xe(n,c){return c[n]?c:{...c,[n]:{strategiesEnabled:!0,webhookEnabled:!1}}}function ve(){var L,_;const n=x.useMemo(()=>re,[]),[c,r]=x.useState(()=>{var T;return A("ct.india.selectedPlanId.v1",((T=n[0])==null?void 0:T.planId)??"")});x.useEffect(()=>k("ct.india.selectedPlanId.v1",c),[c]);const a=x.useMemo(()=>n.find(T=>T.planId===c)??null,[n,c]),[h,m]=x.useState(()=>A("ct.india.planSignals.v1",{}));x.useEffect(()=>k("ct.india.planSignals.v1",h),[h]),x.useEffect(()=>{a!=null&&a.planId&&m(T=>xe(a.planId,T))},[a==null?void 0:a.planId]);const u=a!=null&&a.planId?h[a.planId]:void 0,f=!!(u!=null&&u.strategiesEnabled),t=!!(u!=null&&u.webhookEnabled),[o,b]=x.useState(()=>A("ct.india.strategySelections.v1",{}));x.useEffect(()=>k("ct.india.strategySelections.v1",o),[o]);const p=x.useMemo(()=>a?(o[a.planId]??[]).length:0,[a,o]),[N,s]=x.useState(()=>A("ct.india.masterSlots.v1",ce));x.useEffect(()=>k("ct.india.masterSlots.v1",N),[N]);const[i,d]=x.useState(()=>A("ct.india.followRequests.v1",oe));x.useEffect(()=>k("ct.india.followRequests.v1",i),[i]);const[j,v]=x.useState(!1),[M,E]=x.useState(!1),S=((L=a==null?void 0:a.limits)==null?void 0:L.maxMasterAccounts)??0,F=((_=a==null?void 0:a.limits)==null?void 0:_.maxStrategies)??0,q=S>0&&N.length>=S;return e.jsxs("div",{className:Y,children:[e.jsx(te,{title:"Copy Trading • India (Trader)",plans:n,selectedPlanId:c,onChangePlan:r,accountsUsed:N.length,maxAccounts:S,strategiesEnabled:f,enabledStrategyCount:p,maxStrategies:F,webhookEnabled:t,executionAllowed:!!(a!=null&&a.executionAllowed),limitReached:q,onOpenWebhook:()=>v(!0),onOpenStrategies:()=>E(!0)}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-white/5 bg-slate-900/35 backdrop-blur p-5 md:p-6 shadow-[0_0_0_1px_rgba(255,255,255,0.02)]",children:e.jsx(ne,{slots:N,setSlots:s,maxAccounts:S})}),e.jsx("div",{className:"rounded-2xl border border-white/5 bg-slate-900/35 backdrop-blur p-5 md:p-6 shadow-[0_0_0_1px_rgba(255,255,255,0.02)]",children:e.jsx(ie,{requests:i,setRequests:d})})]}),e.jsx(se,{open:j,onClose:()=>v(!1),plan:a,planSignals:h,setPlanSignals:m}),e.jsx(ae,{open:M,onClose:()=>E(!1),plan:a,planSignals:h,setPlanSignals:m,strategies:de,selections:o,setSelections:b})]})}export{ve as default};
