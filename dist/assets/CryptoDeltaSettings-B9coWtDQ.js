import{r as d,j as e,y as j,s as C}from"./index-_x4LqXeA.js";import{A as U}from"./ApiAccountsManager-BeK6nQjo.js";import{S as Y,T as F}from"./ToggleRow-Bw-dx5bF.js";import"./download-B9Ll9-Qf.js";import"./power-UR2-Hce3.js";import"./plus-Dr61E6Gh.js";import"./ellipsis-vertical-CaplzEpS.js";import"./circle-check-asoqXxuc.js";import"./circle-x-CWS9zTmO.js";function T(...r){return r.filter(Boolean).join(" ")}function W({open:r,onClose:l,plan:n,strategyDefs:t,planSignals:c,setPlanSignals:h,selections:s,setSelections:p,uiDebugUnlockAll:m}){var y;const x=(n==null?void 0:n.planId)??"",o=((y=n==null?void 0:n.limits)==null?void 0:y.maxActiveStrategies)??0,g=x?c[x]:void 0,S=!!(g!=null&&g.strategiesEnabled),w=d.useMemo(()=>n?t.filter(a=>a.planId===n.planId&&a.market==="CRYPTO"):[],[n,t]),f=d.useMemo(()=>x?s[x]??[]:[],[s,x]),v=a=>{x&&h({...c,[x]:{...c[x]??{},strategiesEnabled:a}})},i=a=>{if(!n)return;if(!m&&o<=0){j.error("Your plan doesn't allow strategies.");return}const b=f;if(b.includes(a)){p({...s,[n.planId]:b.filter(N=>N!==a)});return}if(!m&&o===1){p({...s,[n.planId]:[a]});return}if(!m&&o>0&&b.length>=o){j.warning(`Max ${o} strategies allowed for this plan.`);return}p({...s,[n.planId]:[...b,a]})};return e.jsx(Y,{open:r,onClose:l,title:"Crypto Strategies",subtitle:"Enable/disable built-in strategies for this plan. Webhook can be enabled separately.",children:n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{label:"Enable Built-in Strategies",hint:"If OFF, built-in strategies won't execute for this plan.",value:S,onChange:v}),e.jsxs("div",{className:T(S?"":"opacity-60 pointer-events-none"),children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-2",children:["Enabled: ",e.jsx("span",{className:"text-slate-200 font-semibold",children:f.length})," /"," ",e.jsx("span",{className:"text-slate-200 font-semibold",children:o||0}),o===1?" • only one can be active":""]}),e.jsx("div",{className:"grid gap-3",children:w.length===0?e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-xs text-slate-400",children:"No strategies configured for this plan (dummy)."}):w.map(a=>{var N;const b=f.includes(a.id),I=!m&&o>0&&o!==1&&!b&&f.length>=o;return e.jsx("button",{type:"button",onClick:()=>{if(I)return j.warning(`Max ${o} strategies allowed for this plan.`);i(a.id)},className:T("text-left rounded-xl border p-4 transition",b?"border-emerald-500/30 bg-emerald-500/10":"border-white/10 bg-white/5 hover:bg-white/10",I&&"opacity-60 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:a.name}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:a.description}),(N=a.tags)!=null&&N.length?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.tags.map(A=>e.jsx("span",{className:"text-[11px] rounded-full border border-white/10 bg-white/5 text-slate-300 px-2 py-1",children:A},A))}):null]}),e.jsx("span",{className:T("text-[11px] rounded-full border px-2 py-1",b?"border-emerald-500/20 bg-emerald-500/10 text-emerald-200":"border-white/10 bg-white/5 text-slate-300"),children:b?"ENABLED":"DISABLED"})]})},a.id)})})]}),e.jsx("button",{type:"button",onClick:()=>j.success("Saved (dummy)"),className:"w-full rounded-xl border border-emerald-500/30 bg-emerald-500/15 text-emerald-200 hover:bg-emerald-500/20 px-4 py-3 text-sm font-semibold",children:"Save"})]}):e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-xs text-slate-400",children:"Select a plan first."})})}function q(...r){return r.filter(Boolean).join(" ")}function V(){return typeof window>"u"?"https://your-domain.com":window.location.origin||"https://your-domain.com"}function J(){try{const r=new Uint8Array(16);return crypto.getRandomValues(r),Array.from(r).map(l=>l.toString(16).padStart(2,"0")).join("")}catch{return Math.random().toString(16).slice(2)+Math.random().toString(16).slice(2)}}async function E(r){try{await navigator.clipboard.writeText(r),j.success("Copied")}catch{j.error("Copy failed")}}function Z({open:r,onClose:l,plan:n,accounts:t,planSignals:c,setPlanSignals:h}){var v;const s=(n==null?void 0:n.planId)??"",p=s?c[s]:void 0,m=!!(p!=null&&p.webhookEnabled),x=d.useMemo(()=>`${V()}/api/webhooks/tradingview/crypto`,[]),o=d.useMemo(()=>{var a;if(!s)return"";const i=(a=c[s])==null?void 0:a.webhookSecret;if(i)return i;const y=J();return h({...c,[s]:{...c[s]??{},webhookSecret:y}}),y},[s]),g=(p==null?void 0:p.webhookDefaultAccountId)??((v=t[0])!=null&&v.id?String(t[0].id):""),S=i=>{s&&h({...c,[s]:{...c[s]??{},webhookEnabled:i}})},w=i=>{s&&h({...c,[s]:{...c[s]??{},webhookDefaultAccountId:i}})},f=d.useMemo(()=>JSON.stringify({market:"CRYPTO",planId:s||"<PLAN_ID>",accountId:g||"<ACCOUNT_ID>",secret:o||"<SECRET>",symbol:"{{ticker}}",action:"{{strategy.order.action}}",quantity:"{{strategy.order.contracts}}",price:"{{close}}",time:"{{time}}",strategyName:"{{strategy.name}}",comment:"{{strategy.order.comment}}",exchangeType:"SPOT_OR_FUTURES",orderType:"MARKET"},null,2),[s,g,o]);return e.jsx(Y,{open:r,onClose:l,title:"Crypto Webhook",subtitle:"Enable webhook for this plan and copy URL + JSON into TradingView alert.",children:n?e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{label:"Enable TradingView Webhook",hint:"If OFF, TradingView alerts won't trigger trades for this plan.",value:m,onChange:S}),e.jsxs("div",{className:q(m?"":"opacity-60"),children:[e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Webhook URL"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"TradingView Alert → Webhook URL"}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{className:"w-full rounded-xl border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100",readOnly:!0,value:x}),e.jsx("button",{type:"button",className:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 px-3 py-2 text-sm text-slate-200",onClick:()=>E(x),children:e.jsx(C,{size:16})})]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Secret"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Validate this secret on backend."}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{className:"w-full rounded-xl border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100",readOnly:!0,value:o||""}),e.jsx("button",{type:"button",className:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 px-3 py-2 text-sm text-slate-200",onClick:()=>E(o||""),children:e.jsx(C,{size:16})})]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Default Account"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Used in JSON template."}),e.jsxs("select",{className:"mt-2 w-full rounded-xl border border-white/10 bg-slate-950/40 px-3 py-2.5 text-sm text-slate-100 outline-none",value:g,onChange:i=>w(i.target.value),children:[t.length===0?e.jsx("option",{value:"",children:"No accounts added"}):null,t.map(i=>e.jsxs("option",{value:String(i.id),children:[i.apiName," • ",i.type," • ",i.enabled?"Enabled":"Disabled"]},String(i.id)))]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"TradingView JSON Message"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"TradingView Alert → Message"})]}),e.jsx("button",{type:"button",className:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 px-3 py-2 text-sm text-slate-200",onClick:()=>E(f),children:e.jsx(C,{size:16})})]}),e.jsx("pre",{className:"mt-3 rounded-xl border border-white/10 bg-black/30 p-3 text-[12px] text-slate-200 overflow-auto",children:f})]})]}),e.jsx("button",{type:"button",onClick:()=>j.success("Saved (dummy)"),className:"w-full rounded-xl border border-emerald-500/30 bg-emerald-500/15 text-emerald-200 hover:bg-emerald-500/20 px-4 py-3 text-sm font-semibold",children:"Save"})]}):e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-xs text-slate-400",children:"Select a plan first."})})}const $=[{planId:"crypto_basic",planName:"Crypto Basic",endDate:"2026-12-31T23:59:59Z",executionAllowed:!0,limits:{maxConnectedAccounts:2,maxActiveStrategies:1,maxDailyTrades:20,maxLotPerTrade:1}},{planId:"crypto_pro",planName:"Crypto Pro",endDate:"2026-12-31T23:59:59Z",executionAllowed:!0,limits:{maxConnectedAccounts:5,maxActiveStrategies:2,maxDailyTrades:200,maxLotPerTrade:3}},{planId:"crypto_elite",planName:"Crypto Elite",endDate:"2026-12-31T23:59:59Z",executionAllowed:!0,limits:{maxConnectedAccounts:10,maxActiveStrategies:4,maxDailyTrades:500,maxLotPerTrade:10}}],X=[{id:"c_basic_breakout",planId:"crypto_basic",market:"CRYPTO",name:"Breakout Lite",description:"Simple breakout entries with strict caps.",tags:["breakout","safe"]},{id:"c_basic_reversion",planId:"crypto_basic",market:"CRYPTO",name:"Mean Reversion Lite",description:"Range entries for sideways moves.",tags:["reversion"]},{id:"c_pro_trend",planId:"crypto_pro",market:"CRYPTO",name:"Trend Rider",description:"Trend continuation + volatility filters.",tags:["trend"]},{id:"c_pro_scalp",planId:"crypto_pro",market:"CRYPTO",name:"Scalp Pro",description:"Fast entries (use max trades/day).",tags:["scalp","fast"]},{id:"c_elite_trend",planId:"crypto_elite",market:"CRYPTO",name:"Elite Trend",description:"Adaptive trend logic across regimes.",tags:["trend"]},{id:"c_elite_reversion",planId:"crypto_elite",market:"CRYPTO",name:"Elite Reversion",description:"Reversion with volatility bands.",tags:["reversion"]},{id:"c_elite_momentum",planId:"crypto_elite",market:"CRYPTO",name:"Momentum Burst",description:"Momentum burst entries + filters.",tags:["momentum"]},{id:"c_elite_guard",planId:"crypto_elite",market:"CRYPTO",name:"Risk Guard",description:"Extra safety checks and safeguards.",tags:["guard"]}];function k(...r){return r.filter(Boolean).join(" ")}const D=!0,R="inline-flex items-center justify-center gap-2 rounded-xl border px-4 py-2 text-sm font-semibold transition",M="border-white/10 bg-white/5 text-slate-200 hover:bg-white/10",z="h-9 rounded-xl border border-white/10 bg-white/5 px-3 text-sm text-slate-200 outline-none focus:border-emerald-400/60 focus:ring-1 focus:ring-emerald-400/40",L="inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs whitespace-nowrap",B="border-white/10 bg-white/5 text-slate-200",K="border-emerald-500/20 bg-emerald-500/10 text-emerald-200";function O(r,l){try{const n=localStorage.getItem(r);return n?JSON.parse(n):l}catch{return l}}function _(r,l){try{localStorage.setItem(r,JSON.stringify(l))}catch{}}function G(r,l){return l[r]?l:{...l,[r]:{strategiesEnabled:!0,webhookEnabled:!1}}}const H=[{value:"DELTA",label:"Delta",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"apiKey",label:"Delta Api Key",placeholder:"Delta Api Key",required:!0},{key:"apiSecret",label:"Delta Api Secret Key",placeholder:"Delta Api Secret Key",required:!0,type:"password"}]},{value:"BINANCE_FUTURE",label:"Binance Future",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"apiKey",label:"API Key",placeholder:"Binance API Key",required:!0},{key:"apiSecret",label:"API Secret",placeholder:"Binance API Secret",required:!0,type:"password"}]},{value:"COINDCX",label:"CoinDCX",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"apiKey",label:"API Key",placeholder:"CoinDCX API Key",required:!0},{key:"apiSecret",label:"API Secret",placeholder:"CoinDCX API Secret",required:!0,type:"password"}]}];function oe(){var A,P;const r=d.useMemo(()=>$,[]),[l,n]=d.useState(()=>{var u;return O("crypto.selectedPlanId.v1",((u=r[0])==null?void 0:u.planId)??"")});d.useEffect(()=>_("crypto.selectedPlanId.v1",l),[l]);const t=d.useMemo(()=>r.find(u=>u.planId===l)??null,[r,l]),[c,h]=d.useState(()=>O("crypto.planSignals.v1",{}));d.useEffect(()=>_("crypto.planSignals.v1",c),[c]),d.useEffect(()=>{t!=null&&t.planId&&h(u=>G(t.planId,u))},[t==null?void 0:t.planId]);const[s,p]=d.useState(()=>O("crypto.strategySelections.v1",{}));d.useEffect(()=>_("crypto.strategySelections.v1",s),[s]);const m=t!=null&&t.planId?c[t.planId]:void 0,x=!!(m!=null&&m.strategiesEnabled),o=!!(m!=null&&m.webhookEnabled),g=d.useMemo(()=>t?(s[t.planId]??[]).length:0,[t,s]),[S,w]=d.useState(!1),[f,v]=d.useState(!1),[i,y]=d.useState([]);d.useEffect(()=>{y([{id:9001,type:"DELTA",apiName:"Main Delta",enabled:!0,createdAt:"2026-01-10T10:00:00.000Z",updatedAt:"2026-01-20T12:30:00.000Z",meta:{apiKey:"****",apiSecret:"****"}}])},[]);const a=((A=t==null?void 0:t.limits)==null?void 0:A.maxConnectedAccounts)??0,b=((P=t==null?void 0:t.limits)==null?void 0:P.maxActiveStrategies)??0,I=a>0&&i.length>=a,N=!t;return e.jsxs("div",{className:"min-h-screen bg-slate-950 text-white p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"Crypto APIs"}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Plan:"}),e.jsx("select",{className:z,value:l,onChange:u=>n(u.target.value),disabled:r.length<=1,children:r.map(u=>e.jsx("option",{value:u.planId,children:u.planName},u.planId))})]}),e.jsxs("span",{className:k(L,x?K:B),children:["Strategies: ",x?"ON":"OFF"," (",g,"/",b||0,")"]}),e.jsxs("span",{className:k(L,o?K:B),children:["Webhook: ",o?"ON":"OFF"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{type:"button",className:k(R,M),onClick:()=>v(!0),disabled:N,children:"Webhook"}),e.jsx("button",{type:"button",className:k(R,M),onClick:()=>w(!0),disabled:N,children:"Strategies"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Accounts used:"," ",e.jsx("span",{className:"text-slate-200 font-semibold",children:i.length}),a>0?e.jsxs(e.Fragment,{children:[" ","/ ",e.jsx("span",{className:"text-slate-200 font-semibold",children:a})]}):null,I?e.jsx("span",{className:"ml-2 text-amber-300",children:"Plan limit reached"}):null]})]}),e.jsx(U,{title:"Crypto APIs",typeLabel:"API TYPE",typeOptions:H,maxAccounts:a||10,locked:!1,lockedReason:"Upgrade to add more crypto APIs.",uiDebugUnlockAll:D,items:i,onItemsChange:y}),e.jsx(Z,{open:f,onClose:()=>v(!1),plan:t,accounts:i,planSignals:c,setPlanSignals:h}),e.jsx(W,{open:S,onClose:()=>w(!1),plan:t,strategyDefs:X,planSignals:c,setPlanSignals:h,selections:s,setSelections:p,uiDebugUnlockAll:D})]})}export{oe as default};
