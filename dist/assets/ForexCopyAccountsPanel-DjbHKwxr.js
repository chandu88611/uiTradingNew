import{j as e,X as $,r as i,y as o}from"./index-_x4LqXeA.js";import{E as H}from"./ellipsis-vertical-CaplzEpS.js";import{D as Q}from"./download-B9Ll9-Qf.js";import{P as Z}from"./power-UR2-Hce3.js";import{R as ee}from"./refresh-cw-DbxyBI9D.js";import{P as te}from"./plus-Dr61E6Gh.js";import{C as z}from"./crown-BIlIHcvw.js";import{S as se}from"./save-CpCvopvD.js";import{T as ae}from"./trash-2-BfimlZ-T.js";function x(...s){return s.filter(Boolean).join(" ")}const Ne="min-h-screen bg-slate-950 text-white p-6",F="rounded-2xl border border-slate-800 bg-slate-900/60 p-5 shadow-[0_0_0_1px_rgba(255,255,255,0.02)]",Te="rounded-2xl border border-white/5 bg-slate-950/30 backdrop-blur shadow-[0_0_0_1px_rgba(255,255,255,0.02)]",p="inline-flex items-center gap-2 rounded-xl px-4 py-2 text-xs font-semibold transition disabled:opacity-60 disabled:cursor-not-allowed",_="border border-slate-800 bg-slate-900/60 text-slate-200 hover:bg-slate-900/80",le="bg-indigo-500 text-white hover:bg-indigo-400",ne="bg-rose-500 text-slate-950 hover:bg-rose-400",re="bg-yellow-400 text-slate-950 hover:bg-yellow-300",ye="inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-[11px]",S="mt-2 w-full rounded-lg border border-slate-200/15 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400";function P(s){if(!s)return"—";try{const r=new Date(s);return new Intl.DateTimeFormat("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)}catch{return"—"}}function ie({open:s,title:r,onClose:d,children:c}){return s?e.jsxs("div",{className:"fixed inset-0 z-[80]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:d}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-[460px] bg-white text-slate-900 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b",children:[e.jsx("p",{className:"text-base font-semibold",children:r}),e.jsx("button",{type:"button",onClick:d,className:"rounded-lg p-2 hover:bg-slate-100",children:e.jsx($,{size:18})})]}),e.jsx("div",{className:"p-5",children:c})]})]}):null}function oe({onEdit:s,onDelete:r}){const[d,c]=i.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>c(l=>!l),className:"rounded-lg p-2 hover:bg-slate-100/10",children:e.jsx(H,{size:18,className:"text-slate-400"})}),d?e.jsxs("div",{className:"absolute right-0 top-10 w-40 rounded-xl border border-slate-200 bg-white shadow-lg overflow-hidden",children:[e.jsx("button",{className:"w-full px-3 py-2 text-left text-sm hover:bg-slate-100",onClick:()=>{c(!1),s()},children:"Edit"}),e.jsx("button",{className:"w-full px-3 py-2 text-left text-sm hover:bg-slate-100 text-rose-600",onClick:()=>{c(!1),r()},children:"Delete"})]}):null]})}function ce({checked:s,onChange:r,disabled:d}){return e.jsx("button",{type:"button",disabled:d,onClick:()=>r(!s),className:x("relative h-6 w-11 rounded-full border transition",s?"bg-emerald-500/90 border-emerald-400":"bg-slate-800 border-slate-700",d&&"opacity-60 cursor-not-allowed"),"aria-pressed":s,children:e.jsx("span",{className:x("absolute top-[3px] h-4 w-4 rounded-full bg-slate-950 transition",s?"left-6":"left-[3px]")})})}function de(){return Math.floor(1e3+Math.random()*9e3)}function ve({roleMode:s,maxAccounts:r,value:d,onChange:c}){const l=d,k=l.length,N=r>0?k>=r:!1,[T,y]=i.useState({});i.useEffect(()=>{const t={};l.forEach(a=>{t[String(a.id)]=T[String(a.id)]??a.enabled??!0}),y(t)},[l.length]);const M=l.length>0&&l.every(t=>T[String(t.id)]!==!1),I=i.useMemo(()=>l.filter(t=>t.isMaster).length,[l]),q=()=>{const t=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`forex_copy_accounts_${s.toLowerCase()}.json`,n.click(),URL.revokeObjectURL(a)},Y=()=>{const t=!M,a={};l.forEach(n=>a[String(n.id)]=t),y(a),o.success(t?"All accounts turned ON":"All accounts turned OFF")},[B,m]=i.useState(!1),[u,O]=i.useState("CREATE"),[f,L]=i.useState(null),[b,v]=i.useState("MT5"),[g,R]=i.useState(""),[C,E]=i.useState(!0),[j,w]=i.useState(""),[A,D]=i.useState(""),J=()=>{if(N)return o.error("Account limit reached for this plan");O("CREATE"),L(null),v("MT5"),R(""),E(s==="TRADER"),w(""),D(""),m(!0)},W=t=>{O("EDIT"),L(t.id),v(t.type),R(t.label),E(s==="TRADER"?t.isMaster:!1),w(t.userId),D(""),m(!0)},G=()=>{const t=String(b).toUpperCase();if(!g.trim())return o.error("Label is required");if(!j.trim())return o.error(t==="MT5"?"MT5 Login ID is required":"cTrader Account ID is required");if(t==="CTRADER"&&u==="CREATE"&&!A.trim())return o.error("cTrader Access Token is required");const a=new Date().toISOString();if(u==="CREATE"){const n={id:de(),type:t==="CTRADER"?"CTRADER":"MT5",label:g.trim(),enabled:!0,isMaster:s==="TRADER"?!!C:!1,userId:j.trim(),hasToken:t==="CTRADER"?!0:void 0,createdAt:a,updatedAt:a};s==="TRADER"&&n.isMaster&&I>=1&&o.info("You already have a Master. You can still create another, but recommended is only one Master."),c([n,...l]),m(!1),o.success("Saved");return}f&&(c(l.map(n=>{if(n.id!==f)return n;const h=t==="CTRADER";return{...n,type:h?"CTRADER":"MT5",label:g.trim(),userId:j.trim(),isMaster:s==="TRADER"?!!C:!1,hasToken:h?A.trim()?!0:n.hasToken:void 0,updatedAt:a}})),m(!1),o.success("Updated"))},U=t=>{c(l.filter(a=>a.id!==t)),o.success("Deleted")},K=t=>{s==="TRADER"&&(c(l.map(a=>({...a,isMaster:a.id===t,updatedAt:a.id===t?new Date().toISOString():a.updatedAt}))),o.success("Master set"))};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:s==="TRADER"?"Forex Copy • Trader Accounts":"Forex Copy • Your Accounts"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Accounts used: ",e.jsx("span",{className:"text-slate-200 font-semibold",children:k}),r?e.jsxs(e.Fragment,{children:[" ","/ ",e.jsx("span",{className:"text-slate-200 font-semibold",children:r})]}):null,N?e.jsx("span",{className:"ml-2 text-amber-300",children:"Plan limit reached"}):null,s==="TRADER"?e.jsxs("span",{className:"ml-2 text-slate-500",children:["• Masters: ",I]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{type:"button",onClick:q,className:x(p,_),children:[e.jsx(Q,{size:14}),"Export"]}),e.jsxs("button",{type:"button",onClick:Y,disabled:l.length===0,className:x(p,M?"border border-rose-400/30 bg-rose-500/15 text-rose-200 hover:bg-rose-500/20":"border border-emerald-400/30 bg-emerald-500/15 text-emerald-200 hover:bg-emerald-500/20"),children:[e.jsx(Z,{size:14}),"ALL API ON / OFF"]}),e.jsxs("button",{type:"button",onClick:()=>o.info("Dummy refresh"),className:x(p,_),children:[e.jsx(ee,{size:14}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:J,disabled:N,className:x(p,le),children:[e.jsx(te,{size:14}),"Add New"]})]})]}),l.length===0?e.jsxs("div",{className:F,children:[e.jsx("p",{className:"text-slate-200 font-semibold",children:"No accounts added yet."}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["Click “Add New” to connect MT5 or cTrader.",s==="FOLLOWER"?" These are your child accounts used to copy the master.":""]})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:l.map(t=>{const a=String(t.id),n=T[a]!==!1,h=String(t.type).toUpperCase()==="CTRADER";return e.jsxs("div",{className:F,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-base font-semibold text-slate-100",children:t.label}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Type :"}),e.jsx("p",{className:"text-sm text-slate-200 font-medium truncate",children:h?"cTrader":"MT5"}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Account :"}),e.jsx("p",{className:"text-sm text-slate-200 font-medium truncate",children:t.userId}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 flex-wrap",children:[s==="TRADER"?t.isMaster?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-yellow-400/15 px-2.5 py-1 text-[11px] text-yellow-200",children:[e.jsx(z,{size:12})," Master"]}):e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900/60 border border-slate-800 px-2.5 py-1 text-[11px] text-slate-200",children:"Child"}):e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900/60 border border-slate-800 px-2.5 py-1 text-[11px] text-slate-200",children:"Child"}),h?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-900/60 border border-slate-800 px-2.5 py-1 text-[11px] text-slate-200",children:["hasToken: ",t.hasToken?"yes":"no"]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{checked:n,onChange:V=>y(X=>({...X,[a]:V}))}),e.jsx(oe,{onEdit:()=>W(t),onDelete:()=>U(t.id)})]})]}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm text-slate-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Created :"}),e.jsx("span",{children:P(t.createdAt)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Updated :"}),e.jsx("span",{children:P(t.updatedAt)})]})]}),s==="TRADER"&&!t.isMaster?e.jsx("div",{className:"mt-4 flex items-center justify-end",children:e.jsxs("button",{type:"button",onClick:()=>K(t.id),className:x(p,re,"px-3 py-2"),children:[e.jsx(z,{size:14}),"Set Master"]})}):null]},a)})}),e.jsx(ie,{open:B,title:u==="CREATE"?"Add New Account":"Edit Account",onClose:()=>m(!1),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-indigo-600",children:"SELECT TYPE"}),e.jsxs("select",{value:b,onChange:t=>v(t.target.value),className:"mt-2 w-full rounded-lg border border-indigo-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-200",disabled:u==="EDIT",children:[e.jsx("option",{value:"MT5",children:"MT5"}),e.jsx("option",{value:"CTRADER",children:"cTrader"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:"LABEL"}),e.jsx("input",{className:S.replace("mt-2",""),value:g,onChange:t=>R(t.target.value),placeholder:"e.g. Main MT5"})]}),s==="TRADER"?e.jsxs("div",{className:"rounded-xl border border-slate-200 p-3",children:[e.jsx("div",{className:"text-[11px] font-semibold text-slate-600",children:"ROLE"}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-sm",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>E(t.target.checked),className:"h-4 w-4"}),"isMaster (unchecked = Child)"]}),e.jsx("div",{className:"mt-2 text-[11px] text-slate-500",children:"Recommended: keep exactly one Master account for copy trading."})]}):null,e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] font-semibold text-slate-600",children:String(b).toUpperCase()==="CTRADER"?"CTRADER ACCOUNT ID":"MT5 LOGIN ID"}),e.jsx("input",{className:S.replace("mt-2",""),value:j,onChange:t=>w(t.target.value),placeholder:String(b).toUpperCase()==="CTRADER"?"cTrader Account ID":"MT5 Login ID"})]}),String(b).toUpperCase()==="CTRADER"?e.jsxs("div",{children:[e.jsxs("label",{className:"text-[11px] font-semibold text-slate-600",children:["CTRADER ACCESS TOKEN"," ",u==="EDIT"?e.jsx("span",{className:"text-[11px] text-slate-400",children:"(optional)"}):null]}),e.jsx("input",{className:S.replace("mt-2",""),value:A,onChange:t=>D(t.target.value),placeholder:"Paste access token"})]}):null,e.jsxs("div",{className:"pt-2 flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:G,className:"rounded-lg bg-indigo-500 px-6 py-2 text-sm font-semibold text-white hover:bg-indigo-400",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(se,{size:16}),u==="CREATE"?"Submit":"Save Changes"]})}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"rounded-lg bg-rose-100 px-6 py-2 text-sm font-semibold text-rose-600 hover:bg-rose-200",children:"Cancel"})]}),u==="EDIT"&&f?e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("button",{type:"button",onClick:()=>U(f),className:x(p,ne,"px-4 py-2"),children:[e.jsx(ae,{size:14}),"Delete this account"]})}):null]})})]})}export{ie as D,ve as F,ce as S,ye as a,_ as b,x as c,p as d,F as e,le as f,S as i,Ne as p,Te as s};
