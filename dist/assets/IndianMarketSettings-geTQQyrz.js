import{j as e,X as Y,r as c,y as I,s as _}from"./index-_x4LqXeA.js";import{A as Z}from"./ApiAccountsManager-BeK6nQjo.js";import"./download-B9Ll9-Qf.js";import"./power-UR2-Hce3.js";import"./plus-Dr61E6Gh.js";import"./ellipsis-vertical-CaplzEpS.js";import"./circle-check-asoqXxuc.js";import"./circle-x-CWS9zTmO.js";function i(...a){return a.filter(Boolean).join(" ")}const S="rounded-2xl border border-white/5 bg-slate-950/30 backdrop-blur shadow-[0_0_0_1px_rgba(255,255,255,0.02)]",k="inline-flex items-center justify-center gap-2 rounded-xl border px-4 py-2 text-sm font-semibold transition",C="border-white/10 bg-white/5 text-slate-200 hover:bg-white/10",P="border-emerald-500/30 bg-emerald-500/15 text-emerald-200 hover:bg-emerald-500/20",T="mt-1 w-full rounded-xl border border-white/10 bg-slate-950/40 px-3 py-2.5 text-sm text-slate-100 placeholder:text-slate-500 outline-none transition focus:border-emerald-400/60 focus:ring-1 focus:ring-emerald-400/40",U="inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs";function J({open:a,title:l,subtitle:s,onClose:t,children:o,widthClass:h="w-full sm:w-[560px]"}){return e.jsxs("div",{className:i("fixed inset-0 z-50",a?"pointer-events-auto":"pointer-events-none"),"aria-hidden":!a,children:[e.jsx("div",{onClick:t,className:i("absolute inset-0 bg-black/60 transition-opacity",a?"opacity-100":"opacity-0")}),e.jsx("div",{className:i("absolute right-0 top-0 h-full bg-slate-950 border-l border-white/10 shadow-2xl transition-transform",h,a?"translate-x-0":"translate-x-full"),children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"p-5 border-b border-white/10",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-white",children:l}),s?e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:s}):null]}),e.jsx("button",{type:"button",onClick:t,className:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 p-2",children:e.jsx(Y,{size:16,className:"text-slate-200"})})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-5",children:o})]})})]})}function V({label:a,hint:l,value:s,onChange:t}){return e.jsxs("div",{className:"flex items-start justify-between gap-3 rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:a}),l?e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:l}):null]}),e.jsx("button",{type:"button",onClick:()=>t(!s),className:i("relative h-7 w-12 rounded-full border transition",s?"bg-emerald-500/20 border-emerald-500/30":"bg-slate-900 border-white/10"),"aria-pressed":s,children:e.jsx("span",{className:i("absolute top-1 h-5 w-5 rounded-full transition",s?"left-6 bg-emerald-300":"left-1 bg-slate-300")})})]})}function z({open:a,onClose:l,plan:s,strategyDefs:t,planSignals:o,setPlanSignals:h,selections:r,setSelections:p,uiDebugUnlockAll:b}){var w;const x=(s==null?void 0:s.planId)??"",m=((w=s==null?void 0:s.limits)==null?void 0:w.maxActiveStrategies)??0,f=x?o[x]:void 0,N=!!(f!=null&&f.strategiesEnabled),j=c.useMemo(()=>s?t.filter(n=>n.planId===s.planId&&n.market==="INDIA"):[],[s,t]),y=c.useMemo(()=>x?r[x]??[]:[],[r,x]),v=n=>{x&&h({...o,[x]:{...o[x]??{},strategiesEnabled:n}})},d=n=>{if(!s)return;if(!b&&m<=0){I.error("Your plan does not allow strategies.");return}const u=y;if(u.includes(n)){p({...r,[s.planId]:u.filter(A=>A!==n)});return}if(!b&&m===1){p({...r,[s.planId]:[n]});return}if(!b&&m>0&&u.length>=m){I.warning(`Max ${m} strategies allowed for this plan.`);return}p({...r,[s.planId]:[...u,n]})};return e.jsx(J,{open:a,onClose:l,title:"Built-in Strategies",subtitle:"Enable/disable strategies included in your plan. You can keep strategies OFF and use only webhook if you want.",children:s?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:i(S,"p-4"),children:e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:s.planName}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Enabled: ",e.jsx("span",{className:"text-slate-200 font-semibold",children:y.length})," /"," ",e.jsx("span",{className:"text-slate-200 font-semibold",children:m||0}),m===1?" • only one can be active":""]})]}),e.jsx("span",{className:i(U,N?"text-emerald-200 bg-emerald-500/10 border-emerald-500/20":"text-slate-200 bg-white/5 border-white/10"),children:N?"Strategies ON":"Strategies OFF"})]})}),e.jsx(V,{label:"Enable Built-in Strategies",hint:"If OFF, built-in strategies won’t run for this plan. Webhook can still run.",value:N,onChange:v}),e.jsxs("div",{className:i(N?"":"opacity-60 pointer-events-none"),children:[e.jsx("div",{className:"text-xs text-slate-400 mb-2",children:N?"Select strategies to activate:":"Enable strategies to change selection."}),e.jsx("div",{className:"grid gap-3",children:j.length===0?e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-xs text-slate-400",children:"No strategies configured (dummy)."}):j.map(n=>{var A;const u=y.includes(n.id),E=!b&&m>0&&m!==1&&!u&&y.length>=m;return e.jsx("button",{type:"button",onClick:()=>{if(E){I.warning(`Max ${m} strategies allowed for this plan.`);return}d(n.id)},className:i("text-left rounded-xl border p-4 transition",u?"border-emerald-500/30 bg-emerald-500/10":"border-white/10 bg-white/5 hover:bg-white/10",E&&"opacity-60 cursor-not-allowed"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:n.name}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:n.description}),(A=n.tags)!=null&&A.length?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:n.tags.map(O=>e.jsx("span",{className:"text-[11px] rounded-full border border-white/10 bg-white/5 text-slate-300 px-2 py-1",children:O},O))}):null]}),e.jsx("span",{className:i("text-[11px] rounded-full border px-2 py-1",u?"border-emerald-500/20 bg-emerald-500/10 text-emerald-200":"border-white/10 bg-white/5 text-slate-300"),children:u?"ENABLED":"DISABLED"})]})},n.id)})})]}),e.jsx("button",{type:"button",className:i(k,P,"w-full"),onClick:()=>I.success("Saved (dummy)"),children:"Save"})]}):e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-xs text-slate-400",children:"Select a plan first."})})}function G(){return typeof window>"u"?"https://your-domain.com":window.location.origin||"https://your-domain.com"}function H(){try{const a=new Uint8Array(16);return crypto.getRandomValues(a),Array.from(a).map(l=>l.toString(16).padStart(2,"0")).join("")}catch{return Math.random().toString(16).slice(2)+Math.random().toString(16).slice(2)}}async function D(a){try{await navigator.clipboard.writeText(a),I.success("Copied")}catch{I.error("Copy failed")}}function $({open:a,onClose:l,plan:s,accounts:t,planSignals:o,setPlanSignals:h}){var v;const r=(s==null?void 0:s.planId)??"",p=r?o[r]:void 0,b=!!(p!=null&&p.webhookEnabled),x=c.useMemo(()=>`${G()}/api/webhooks/tradingview/india`,[]),m=c.useMemo(()=>{var n;if(!r)return"";const d=(n=o[r])==null?void 0:n.webhookSecret;if(d)return d;const w=H();return h({...o,[r]:{...o[r]??{},webhookSecret:w}}),w},[r]),f=(p==null?void 0:p.webhookDefaultAccountId)??((v=t[0])!=null&&v.id?String(t[0].id):""),N=d=>{r&&h({...o,[r]:{...o[r]??{},webhookEnabled:d}})},j=d=>{r&&h({...o,[r]:{...o[r]??{},webhookDefaultAccountId:d}})},y=c.useMemo(()=>JSON.stringify({market:"INDIA",planId:r||"<PLAN_ID>",accountId:f||"<ACCOUNT_ID>",secret:m||"<SECRET>",symbol:"{{ticker}}",exchange:"{{exchange}}",action:"{{strategy.order.action}}",quantity:"{{strategy.order.contracts}}",price:"{{close}}",time:"{{time}}",orderType:"MARKET",strategyName:"{{strategy.name}}",comment:"{{strategy.order.comment}}"},null,2),[r,f,m]);return e.jsx(J,{open:a,onClose:l,title:"TradingView Webhook",subtitle:"Enable webhook and copy URL + JSON into TradingView alert. You can keep webhook OFF and use only built-in strategies if you want.",children:s?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:i(S,"p-4"),children:e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:s.planName}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Webhook is per-plan. Secret should be validated by backend."})]}),e.jsx("span",{className:i(U,b?"text-emerald-200 bg-emerald-500/10 border-emerald-500/20":"text-slate-200 bg-white/5 border-white/10"),children:b?"Webhook ON":"Webhook OFF"})]})}),e.jsx(V,{label:"Enable TradingView Webhook",hint:"If OFF, TradingView alerts won’t trigger trades for this plan.",value:b,onChange:N}),e.jsxs("div",{className:i(b?"":"opacity-60"),children:[e.jsxs("div",{className:i(S,"p-4"),children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Webhook URL"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"TradingView Alert → Webhook URL"}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{className:i(T,"mt-0"),readOnly:!0,value:x}),e.jsxs("button",{type:"button",className:i(k,C),onClick:()=>D(x),children:[e.jsx(_,{size:16})," Copy"]})]})]}),e.jsxs("div",{className:i(S,"p-4"),children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Secret"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Put this inside JSON and validate on server."}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{className:i(T,"mt-0"),readOnly:!0,value:m||""}),e.jsxs("button",{type:"button",className:i(k,C),onClick:()=>D(m||""),children:[e.jsx(_,{size:16})," Copy"]})]})]}),e.jsxs("div",{className:i(S,"p-4"),children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Default Account"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"This accountId is inserted in the JSON template."}),e.jsxs("select",{className:T,value:f,onChange:d=>j(d.target.value),children:[t.length===0?e.jsx("option",{value:"",children:"No accounts added"}):null,t.map(d=>e.jsxs("option",{value:String(d.id),children:[d.apiName," • ",d.type," • ",d.enabled?"Enabled":"Disabled"]},String(d.id)))]})]}),e.jsxs("div",{className:i(S,"p-4"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"TradingView JSON Message"}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"TradingView Alert → Message"})]}),e.jsxs("button",{type:"button",className:i(k,C),onClick:()=>D(y),children:[e.jsx(_,{size:16})," Copy JSON"]})]}),e.jsx("pre",{className:"mt-3 rounded-xl border border-white/10 bg-black/30 p-3 text-[12px] text-slate-200 overflow-auto",children:y})]})]}),e.jsx("button",{type:"button",className:i(k,P,"w-full"),onClick:()=>I.success("Saved (dummy)"),children:"Save"}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:["If both ",e.jsx("b",{children:"Strategies"})," and ",e.jsx("b",{children:"Webhook"})," are ON, engine accepts signals from both sources."]})]}):e.jsx("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 text-xs text-slate-400",children:"Select a plan first."})})}const X=[{planId:"plan_india_basic",planName:"India Basic",endDate:"2026-12-31T23:59:59Z",executionAllowed:!0,limits:{maxConnectedAccounts:2,maxActiveStrategies:1,maxDailyTrades:20,maxLotPerTrade:1}},{planId:"plan_india_elite",planName:"India Elite",endDate:"2026-06-30T23:59:59Z",executionAllowed:!0,limits:{maxConnectedAccounts:10,maxActiveStrategies:3,maxDailyTrades:200,maxLotPerTrade:5}}],Q=[{id:"in_basic_swing",planId:"plan_india_basic",market:"INDIA",name:"Swing Builder",description:"Retail friendly swing entries.",tags:["swing","low-risk"]},{id:"in_basic_breakout",planId:"plan_india_basic",market:"INDIA",name:"Breakout Lite",description:"Breakouts with strict caps. Avoid news.",tags:["breakout"]},{id:"in_elite_swing_plus",planId:"plan_india_elite",market:"INDIA",name:"Swing Builder+",description:"Better filtering + more signals.",tags:["swing"]},{id:"in_elite_intraday",planId:"plan_india_elite",market:"INDIA",name:"Intraday Momentum",description:"Intraday momentum. Needs max trades/day.",tags:["intraday","fast"]},{id:"in_elite_reversion",planId:"plan_india_elite",market:"INDIA",name:"Mean Reversion",description:"Range entries. Best in sideways markets.",tags:["reversion"]}],q=!0,ee=[{value:"KITE",label:"Kite",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"apiKey",label:"Kite Api Key",placeholder:"Kite Api Key",required:!0},{key:"apiSecret",label:"Kite Api Secret Key",placeholder:"Kite Api Secret Key",required:!0,type:"password"}]},{value:"DHAN",label:"Dhan",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"clientId",label:"Client Id",placeholder:"Client Id",required:!0},{key:"token",label:"Access Token",placeholder:"Access Token",required:!0,type:"password"}]},{value:"ANGEL",label:"Angel",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"clientId",label:"Client Id",placeholder:"Client Id",required:!0},{key:"apiKey",label:"Api Key",placeholder:"Api Key",required:!0},{key:"apiSecret",label:"Api Secret",placeholder:"Api Secret",required:!0,type:"password"}]},{value:"UPSTOX",label:"Upstox",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0},{key:"apiKey",label:"Api Key",placeholder:"Api Key",required:!0},{key:"apiSecret",label:"Api Secret",placeholder:"Api Secret",required:!0,type:"password"}]},{value:"FYERS",label:"Fyers",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0}]},{value:"SHOONYA",label:"Shoonya",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0}]},{value:"ALICEBLUE",label:"AliceBlue",fields:[{key:"apiName",label:"Api Name",placeholder:"Api Name",required:!0}]}];function K(a,l){try{const s=localStorage.getItem(a);return s?JSON.parse(s):l}catch{return l}}function F(a,l){try{localStorage.setItem(a,JSON.stringify(l))}catch{}}function te(a,l){return l[a]?l:{...l,[a]:{strategiesEnabled:!0,webhookEnabled:!1}}}const B="inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs whitespace-nowrap",R="border-white/10 bg-white/5 text-slate-200",W="border-emerald-500/20 bg-emerald-500/10 text-emerald-200";function ce(){var O,L;const a=c.useMemo(()=>X,[]);a.length>0;const[l,s]=c.useState(()=>{var M;return K("india.selectedPlanId.v1",null)??((M=a[0])==null?void 0:M.planId)??""});c.useEffect(()=>{l&&F("india.selectedPlanId.v1",l)},[l]);const t=c.useMemo(()=>a.find(g=>g.planId===l)??null,[a,l]),[o,h]=c.useState(()=>K("india.planSignals.v1",{}));c.useEffect(()=>F("india.planSignals.v1",o),[o]),c.useEffect(()=>{t!=null&&t.planId&&h(g=>te(t.planId,g))},[t==null?void 0:t.planId]);const r=t!=null&&t.planId?o[t.planId]:void 0,p=!!(r!=null&&r.strategiesEnabled),b=!!(r!=null&&r.webhookEnabled),[x,m]=c.useState(()=>K("india.strategySelections.v1",{}));c.useEffect(()=>F("india.strategySelections.v1",x),[x]);const f=c.useMemo(()=>t?(x[t.planId]??[]).length:0,[x,t]),[N,j]=c.useState(!1),[y,v]=c.useState(!1),[d,w]=c.useState([]);c.useEffect(()=>{w([{id:4108,type:"DHAN",apiName:"Pankaj",enabled:!0,createdAt:"2026-01-20T03:27:00.000Z",updatedAt:"2026-01-20T11:44:00.000Z",meta:{clientId:"xxxx",token:"****"}},{id:3748,type:"KITE",apiName:"Pankaj",enabled:!1,createdAt:"2025-12-18T19:07:00.000Z",updatedAt:"2026-01-20T08:58:00.000Z",meta:{apiKey:"****",apiSecret:"****"}}])},[]);const n=!t,u=((O=t==null?void 0:t.limits)==null?void 0:O.maxConnectedAccounts)??0,E=((L=t==null?void 0:t.limits)==null?void 0:L.maxActiveStrategies)??0,A=u>0&&d.length>=u;return e.jsxs("div",{className:"min-h-screen bg-slate-950 text-white p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-slate-100",children:"Indian APIs"}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Plan:"}),e.jsx("select",{className:i("h-9 rounded-xl border border-white/10 bg-white/5 px-3 text-sm text-slate-200 outline-none","focus:border-emerald-400/60 focus:ring-1 focus:ring-emerald-400/40"),value:l,onChange:g=>s(g.target.value),disabled:a.length<=1,children:a.map(g=>e.jsx("option",{value:g.planId,children:g.planName},g.planId))})]}),e.jsxs("span",{className:i(B,p?W:R),children:["Strategies: ",p?"ON":"OFF"," (",f,"/",E||0,")"]}),e.jsxs("span",{className:i(B,b?W:R),children:["Webhook: ",b?"ON":"OFF"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{type:"button",className:i(k,C),onClick:()=>v(!0),disabled:n,children:"Webhook"}),e.jsx("button",{type:"button",className:i(k,C),onClick:()=>j(!0),disabled:n,children:"Strategies"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-400",children:["Accounts used:"," ",e.jsx("span",{className:"text-slate-200 font-semibold",children:d.length}),u>0?e.jsxs(e.Fragment,{children:[" ","/ ",e.jsx("span",{className:"text-slate-200 font-semibold",children:u})]}):null,A?e.jsx("span",{className:"ml-2 text-amber-300",children:"Plan limit reached"}):null]})]}),e.jsx(Z,{title:"Indian APIs",typeLabel:"API TYPE",typeOptions:ee,maxAccounts:u||10,locked:!!n,lockedReason:"Upgrade to add Indian broker APIs.",uiDebugUnlockAll:q,items:d,onItemsChange:w}),e.jsx($,{open:y,onClose:()=>v(!1),plan:t,accounts:d,planSignals:o,setPlanSignals:h}),e.jsx(z,{open:N,onClose:()=>j(!1),plan:t,strategyDefs:Q,planSignals:o,setPlanSignals:h,selections:x,setSelections:m,uiDebugUnlockAll:q})]})}export{ce as default};
