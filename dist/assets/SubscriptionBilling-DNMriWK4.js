import{u as w,r as o,h as B,k as C,j as e,m as g,U as h,A}from"./index-_x4LqXeA.js";import{S as P}from"./SubscriptionStepper-BNmpuGyS.js";import{I as k}from"./info-DjzTicev.js";import{M as O}from"./map-pin-DjW0nyJt.js";import{C as E}from"./circle-check-big-AF7bSAwP.js";import"./circle-check-asoqXxuc.js";const N="subscription_flow_v1",I={panNumber:"",addressLine1:"",addressLine2:"",city:"",state:"",pincode:""},G=()=>{const f=w(),[a,m]=o.useState(I),[j,u]=o.useState({}),{data:c,isLoading:r}=B(),[v,{isLoading:p}]=C();o.useEffect(()=>{const s=sessionStorage.getItem(N);if(!s){window.location.href="/subscriptions";return}try{const t=JSON.parse(s);if(!(t!=null&&t.termsAccepted)||!(t!=null&&t.planId)){const i=new URLSearchParams;t!=null&&t.planId&&i.set("planId",String(t.planId)),t!=null&&t.mode&&i.set("mode",t.mode),window.location.href=`/subscriptions/terms?${i.toString()}`;return}}catch{sessionStorage.removeItem(N),window.location.href="/subscriptions"}},[]),o.useEffect(()=>{const s=c==null?void 0:c.data;s&&m({panNumber:(s.panNumber??"").toUpperCase(),addressLine1:s.addressLine1??"",addressLine2:s.addressLine2??"",city:s.city??"",state:s.state??"",pincode:s.pincode??""})},[c]);const n=(s,t)=>{m(i=>({...i,[s]:t}))},l=s=>{u(t=>({...t,[s]:!0}))},d=o.useMemo(()=>{const s=a.panNumber.trim().toUpperCase(),t=a.pincode.trim(),i=!s||/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(s),L=!!t&&/^[0-9]{6}$/.test(t),S=a.addressLine1.trim()&&a.city.trim()&&a.state.trim()&&a.pincode.trim();return{panOk:i,pinOk:L,requiredOk:S}},[a]),x=d.requiredOk&&d.pinOk&&d.panOk,b=(s,t)=>!!j[s]&&!t,y=async s=>{if(s.preventDefault(),u({panNumber:!0,addressLine1:!0,addressLine2:!0,city:!0,state:!0,pincode:!0}),!!x)try{await v({panNumber:a.panNumber.trim()?a.panNumber.trim().toUpperCase():null,addressLine1:a.addressLine1.trim(),addressLine2:a.addressLine2.trim()||null,city:a.city.trim(),state:a.state.trim(),pincode:a.pincode.trim()}).unwrap(),f("/subscriptions/payment")}catch(t){console.error("Save billing failed:",t),alert("Failed to save billing details. Please try again.")}};return e.jsx("div",{className:"min-h-screen px-6 pt-16 md:pt-28 bg-slate-950 text-slate-100 p-6 flex justify-center",children:e.jsxs("div",{className:"max-w-5xl w-full space-y-8",children:[e.jsx(P,{currentStep:3}),e.jsxs(g.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-semibold flex items-center gap-3",children:[e.jsx(h,{size:32,className:"text-emerald-400"}),"Billing Details (Invoice)"]}),e.jsx("p",{className:"text-slate-400 mt-2 text-sm max-w-xl",children:"We use these details only for invoices / basic KYC. Bank details are not required."})]}),e.jsxs("div",{className:"bg-slate-900/70 border border-slate-800 rounded-xl p-3 text-xs text-slate-400 flex gap-3",children:[e.jsx(k,{size:16,className:"text-emerald-400 mt-0.5"}),e.jsx("p",{children:"Provide correct address & PAN (PAN optional) for GST invoices."})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-[2fr,1.1fr] gap-6",children:[e.jsxs(g.form,{onSubmit:y,initial:{opacity:0},animate:{opacity:1},className:"bg-slate-900/60 border border-slate-800 rounded-2xl p-8 space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(h,{size:20,className:"text-emerald-400"}),"PAN (Optional)"]}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm",children:"PAN Number"}),e.jsx("input",{maxLength:10,value:a.panNumber,onChange:s=>n("panNumber",s.target.value.toUpperCase()),onBlur:()=>l("panNumber"),className:"mt-1 w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:border-emerald-400 outline-none",placeholder:"ABCDE1234F",disabled:r}),b("panNumber",d.panOk)&&e.jsx("p",{className:"text-xs text-red-300 mt-1",children:"Enter a valid PAN (ABCDE1234F)"})]})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(O,{size:20,className:"text-emerald-400"}),"Address (for GST invoices)"]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm",children:"Address Line 1"}),e.jsx("input",{required:!0,value:a.addressLine1,onChange:s=>n("addressLine1",s.target.value),onBlur:()=>l("addressLine1"),className:"mt-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm w-full focus:border-emerald-400 outline-none",placeholder:"Flat / House / Building",disabled:r})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm",children:"Address Line 2"}),e.jsx("input",{value:a.addressLine2,onChange:s=>n("addressLine2",s.target.value),onBlur:()=>l("addressLine2"),className:"mt-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm w-full focus:border-emerald-400 outline-none",placeholder:"Road / Area / Locality",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"City"}),e.jsx("input",{required:!0,value:a.city,onChange:s=>n("city",s.target.value),onBlur:()=>l("city"),className:"mt-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm w-full focus:border-emerald-400 outline-none",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"State"}),e.jsx("input",{required:!0,value:a.state,onChange:s=>n("state",s.target.value),onBlur:()=>l("state"),className:"mt-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm w-full focus:border-emerald-400 outline-none",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Pincode"}),e.jsx("input",{required:!0,maxLength:6,value:a.pincode,onChange:s=>n("pincode",s.target.value),onBlur:()=>l("pincode"),className:"mt-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm w-full focus:border-emerald-400 outline-none",disabled:r}),b("pincode",d.pinOk)&&e.jsx("p",{className:"text-xs text-red-300 mt-1",children:"Pincode must be 6 digits"})]})]})]}),e.jsxs("button",{type:"submit",disabled:p||r||!x,className:"w-full bg-emerald-500 text-slate-900 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 hover:bg-emerald-400 transition disabled:opacity-60 disabled:cursor-not-allowed",children:[e.jsx(E,{size:18}),p?"Saving...":"Save & Continue to Payment",e.jsx(A,{size:18})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-slate-900/70 border border-slate-800 rounded-2xl p-5",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Why we need this?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-slate-400",children:[e.jsx("li",{children:"To generate GST-compliant invoices."}),e.jsx("li",{children:"Basic identity verification (PAN optional)."})]})]})})]})]})})};export{G as default};
