import{r as l,x as M,j as e,m as w,I as u,S as z,A as T}from"./index-_x4LqXeA.js";import{S as k}from"./SubscriptionStepper-BNmpuGyS.js";import{a as D,b as E}from"./profileSubscription.api-Cchy4I3l.js";import{C as O}from"./credit-card-Btv1osjQ.js";import{T as R}from"./triangle-alert-D1FQ0MAl.js";import{C as F}from"./clock-Dgf8poUI.js";import"./circle-check-asoqXxuc.js";const S="subscription_flow_v1",G=a=>`₹${Math.round(a/100).toLocaleString("en-IN")}`,J=()=>{var v;const[a,h]=l.useState(null),[f,b]=l.useState(!1),{data:c,isLoading:j}=M(void 0,{refetchOnMountOrArgChange:!0}),g=Number(((v=c==null?void 0:c.data)==null?void 0:v.id)||0),o=!!g;l.useEffect(()=>{const r=sessionStorage.getItem(S);if(!r){window.location.href="/subscriptions";return}try{const t=JSON.parse(r);if(!(t!=null&&t.planId)){window.location.href="/subscriptions";return}if(!(t!=null&&t.termsAccepted)){const p=new URLSearchParams;p.set("planId",String(t.planId)),p.set("mode",t.mode||"copy"),window.location.href=`/subscriptions/terms?${p.toString()}`;return}h(t)}catch{sessionStorage.removeItem(S),window.location.href="/subscriptions"}},[]);const d=(a==null?void 0:a.planId)||0,{data:m,isLoading:I}=D(d,{skip:!d}),s=m==null?void 0:m.data,[P]=E(),n=Number((s==null?void 0:s.priceCents)||0),N=18,y=l.useMemo(()=>Math.round(n*N/100),[n]),x=n+y,C=(s==null?void 0:s.name)||"Selected Plan",A=(s==null?void 0:s.description)||"",L=async()=>{var r;if(a!=null&&a.planId){if(!o){window.location.href="/subscriptions";return}try{b(!0);const t=await P({planId:a.planId,trialDays:void 0}).unwrap();window.location.href="/subscriptions/success"}catch(t){console.error("Subscription activation failed:",t),alert(((r=t==null?void 0:t.data)==null?void 0:r.message)||"Failed to activate subscription. Please try again.")}finally{b(!1)}}},i=I||j||!a;return e.jsx("div",{className:"min-h-screen px-6 pt-16 md:pt-28 bg-slate-950 text-slate-100 p-6 flex justify-center",children:e.jsxs("div",{className:"max-w-3xl w-full space-y-8",children:[e.jsx(k,{currentStep:4}),e.jsxs(w.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[e.jsxs("h1",{className:"text-3xl font-semibold flex items-center gap-3",children:[e.jsx(O,{size:32,className:"text-emerald-400"}),"Confirm & Activate Subscription"]}),e.jsx("p",{className:"text-slate-400 mt-2 text-sm",children:"Review your plan summary and proceed."})]}),!o&&!j&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4 text-sm text-red-200 flex gap-3",children:[e.jsx(R,{className:"mt-0.5",size:18}),e.jsx("div",{children:"You are not logged in. Please login and come back to activate."})]}),e.jsxs(w.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"bg-slate-900/70 border border-slate-800 rounded-2xl p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase mb-1",children:"Plan"}),e.jsx("p",{className:"text-sm font-semibold text-slate-100",children:i?"Loading...":C}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:i?"—":A||"—"}),(a==null?void 0:a.mode)&&e.jsxs("p",{className:"text-[11px] text-slate-500 mt-2",children:["Mode: ",e.jsx("span",{className:"text-slate-300 font-semibold",children:a.mode})," • Plan ID: ",e.jsx("span",{className:"text-slate-300 font-semibold",children:d})," • User ID: ",e.jsx("span",{className:"text-slate-300 font-semibold",children:g||"—"})]})]}),e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase mb-1",children:"Price"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:i?"—":G(n)}),e.jsx("p",{className:"text-[11px] text-slate-500",children:(s==null?void 0:s.interval)==="monthly"?"per month":(s==null?void 0:s.interval)==="yearly"?"per year":"lifetime"})]})]}),e.jsxs("div",{className:"border-t border-slate-800 pt-4",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase mb-3",children:"Payment Summary"}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Plan price"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{size:14}),i?"—":Math.round(n/100).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between text-slate-400 text-xs",children:[e.jsxs("span",{children:["GST @ ",N,"%"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(u,{size:12}),i?"—":Math.round(y/100).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between mt-2 pt-2 border-t border-slate-800",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Total payable now"}),e.jsxs("span",{className:"flex items-center gap-1 text-lg font-semibold text-emerald-400",children:[e.jsx(u,{size:18}),i?"—":Math.round(x/100).toLocaleString("en-IN")]})]}),x===0&&e.jsx("p",{className:"text-[11px] text-slate-500 mt-1",children:"No upfront fee for this plan currently."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 text-xs text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{size:16,className:"text-emerald-400"}),e.jsx("span",{children:"Gateway will be integrated here later."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:14,className:"text-slate-500"}),e.jsx("span",{children:"Activation will happen after confirmation."})]})]}),e.jsxs("button",{disabled:i||f||!o,onClick:L,className:"w-full mt-2 bg-emerald-500 text-slate-900 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 hover:bg-emerald-400 transition disabled:opacity-60 disabled:cursor-not-allowed",children:[f?"Activating...":x===0?"Activate Subscription":"Pay & Activate",e.jsx(T,{size:18})]})]})]})})};export{J as default};
